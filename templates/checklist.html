{% extends "base.html" %}
{% block title %}Checklist - HIPAA Training System{% endblock %}
{% block content %}
    <header class="header" role="banner">
        <div class="user-context">
            <span class="user-role" aria-label="User role: {{ user_role }}">{{ user_role }}</span>
            <span>{{ facility }}</span>
        </div>
        <h1>âœ… HIPAA Compliance Checklist</h1>
        <div class="subtitle">Complete Essential Safeguards</div>
    </header>

    <section class="checklist-container" aria-label="Compliance Checklist">
        {% for item in checklist_items %}
            <div class="checklist-item">
                <input type="checkbox"
                       id="item_{{ item.id }}"
                       {% if progress['checklist_' + item.id|string] %}checked{% endif %}
                       onchange="updateChecklist({{ item.id }}, this.checked)"
                       aria-label="{{ item.text }} - {{ item.category }}">
                <label for="item_{{ item.id }}">{{ item.text }} ({{ item.category }})</label>
            </div>
        {% endfor %}
    </section>

    <style>
        .checklist-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
        }
        .checklist-item {
            margin: 10px 0;
        }
        .checklist-item input {
            margin-right: 10px;
        }
    </style>

    <script>
        async function updateChecklist(itemId, completed) {
            try {
                const response = await fetch('/api/update_checklist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ item_id: itemId, completed })
                });
                if (!response.ok) {
                    throw new Error('Failed to update checklist');
                }
            } catch (error) {
                console.error('Checklist update error:', error);
                alert('An error occurred while updating the checklist.');
            }
        }
    </script>
{% endblock %}
