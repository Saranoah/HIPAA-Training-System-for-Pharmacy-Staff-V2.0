<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HIPAA Training System - Interactive Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .float { animation: float 3s ease-in-out infinite; }
        .slide-in { animation: slideIn 0.5s ease-out; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .confetti { animation: confetti 3s ease-out forwards; }
        
        .progress-ring {
            transition: stroke-dashoffset 0.5s ease;
        }
        
        .hover-scale:hover {
            transform: scale(1.05);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen">
    <!-- Header Stats Bar -->
    <div id="statsBar" class="bg-white shadow-lg border-b-4 border-purple-500 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="text-2xl font-bold gradient-text">HIPAA Training</div>
                    <div class="flex items-center gap-2 bg-orange-100 px-3 py-1 rounded-full">
                        <span class="text-xl">üî•</span>
                        <span class="font-bold text-orange-700"><span id="streakCount">0</span> day streak</span>
                    </div>
            `;
        }

        // Answer Question
        function answerQuestion(answerIndex) {
            quizAnswers.push(answerIndex);
            
            if (currentQuizQuestion < quizQuestions.length - 1) {
                currentQuizQuestion++;
                renderQuizQuestion();
            } else {
                submitQuiz();
            }
        }

        // Submit Quiz
        async function submitQuiz() {
            const response = await fetch('/api/submit-quiz', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ answers: quizAnswers })
            });
            
            const result = await response.json();
            await loadProgress();
            updateStats();
            renderQuizResults(result);
        }

        // Render Quiz Results
        function renderQuizResults(result) {
            document.getElementById('quizQuestions').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            const isPerfect = result.correct === result.total;
            
            document.getElementById('quizResults').innerHTML = `
                <div class="bg-white rounded-3xl shadow-2xl p-12 text-center fade-in">
                    ${isPerfect ? '<div id="confettiContainer"></div>' : ''}
                    
                    <div class="inline-block p-6 bg-gradient-to-br from-${result.badge.color}-400 to-${result.badge.color}-600 rounded-full mb-6">
                        <div class="text-6xl">${result.badge.icon}</div>
                    </div>
                    
                    <h2 class="text-4xl font-bold text-gray-800 mb-2">${isPerfect ? 'Perfect Score! üéâ' : 'Quiz Complete!'}</h2>
                    <p class="text-xl text-gray-600 mb-8">${result.badge.name}</p>
                    
                    <div class="grid grid-cols-3 gap-4 mb-8">
                        <div class="bg-blue-50 rounded-xl p-6">
                            <div class="text-3xl font-bold text-blue-600 mb-2">${result.correct}/${result.total}</div>
                            <div class="text-sm text-gray-600">Correct Answers</div>
                        </div>
                        <div class="bg-purple-50 rounded-xl p-6">
                            <div class="text-3xl font-bold text-purple-600 mb-2">+${result.xp_earned}</div>
                            <div class="text-sm text-gray-600">XP Earned</div>
                        </div>
                        <div class="bg-orange-50 rounded-xl p-6">
                            <div class="text-3xl font-bold text-orange-600 mb-2">${Math.round(result.percentage)}%</div>
                            <div class="text-sm text-gray-600">Score</div>
                        </div>
                    </div>
                    
                    <div class="text-left mb-8 space-y-4">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Review Your Answers</h3>
                        ${result.results.map((r, i) => `
                            <div class="p-4 rounded-xl border-2 ${r.correct ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}">
                                <div class="flex items-start gap-3 mb-2">
                                    <div class="text-2xl">${r.correct ? '‚úÖ' : '‚ùå'}</div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 mb-2">Question ${i + 1}: ${quizQuestions[i].question}</p>
                                        ${!r.correct ? `<p class="text-sm text-red-700 mb-1">Your answer: ${quizQuestions[i].options[r.user_answer]}</p>` : ''}
                                        ${!r.correct ? `<p class="text-sm text-green-700 mb-1">Correct answer: ${quizQuestions[i].options[r.correct_answer]}</p>` : ''}
                                        <p class="text-sm text-gray-700 mt-2">${r.explanation}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex gap-4 justify-center">
                        <button onclick="resetQuiz()" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 px-8 rounded-2xl hover:shadow-xl transition-all hover-scale">
                            Try Again üîÑ
                        </button>
                        <button onclick="showSection('lessons')" class="bg-gray-200 text-gray-700 font-bold py-4 px-8 rounded-2xl hover:shadow-xl transition-all hover-scale">
                            Back to Lessons
                        </button>
                    </div>
                </div>
            `;
            
            if (isPerfect) {
                createConfetti();
            }
        }

        // Reset Quiz
        function resetQuiz() {
            document.getElementById('quizResults').classList.add('hidden');
            document.getElementById('quizStart').classList.remove('hidden');
            currentQuizQuestion = 0;
            quizAnswers = [];
        }

        // Render Checklist
        function renderChecklist() {
            const container = document.getElementById('checklistContainer');
            const categories = {};
            
            checklistItems.forEach(item => {
                if (!categories[item.category]) {
                    categories[item.category] = [];
                }
                categories[item.category].push(item);
            });
            
            container.innerHTML = '';
            
            Object.entries(categories).forEach(([category, items]) => {
                container.innerHTML += `
                    <div class="mb-6">
                        <h4 class="font-bold text-gray-700 mb-3 text-lg">${category}</h4>
                        <div class="space-y-2">
                            ${items.map(item => {
                                const isChecked = currentProgress.checklist?.[item.id] || false;
                                return `
                                    <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-all cursor-pointer" onclick="toggleChecklistItem('${item.id}')">
                                        <input type="checkbox" ${isChecked ? 'checked' : ''} class="w-5 h-5 text-blue-600 rounded" onclick="event.stopPropagation()">
                                        <span class="flex-1 ${isChecked ? 'text-gray-500 line-through' : 'text-gray-800 font-medium'}">${item.text}</span>
                                        ${isChecked ? '<span class="text-green-600 text-xl">‚úì</span>' : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });
            
            updateChecklistProgress();
        }

        // Toggle Checklist Item
        async function toggleChecklistItem(itemId) {
            const currentValue = currentProgress.checklist?.[itemId] || false;
            
            const response = await fetch('/api/update-checklist', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    item_id: itemId,
                    checked: !currentValue
                })
            });
            
            const result = await response.json();
            await loadProgress();
            updateStats();
            renderChecklist();
            
            if (!currentValue) {
                showXPAnimation(5);
            }
        }

        // Update Checklist Progress
        function updateChecklistProgress() {
            const completed = Object.values(currentProgress.checklist || {}).filter(v => v).length;
            const total = checklistItems.length;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('checklistPercentage').textContent = percentage;
            document.getElementById('checklistProgress').style.width = percentage + '%';
        }

        // Render Progress Page
        function renderProgress() {
            document.getElementById('totalXP').textContent = currentProgress.xp || 0;
            document.getElementById('currentLevel').textContent = currentProgress.level || 1;
            document.getElementById('currentStreak').textContent = currentProgress.streak || 0;
            document.getElementById('lessonsCompleted').textContent = (currentProgress.lessons_completed || []).length;
            
            // Render badges
            const badgesContainer = document.getElementById('badgesContainer');
            const badges = currentProgress.badges || [];
            
            if (badges.length === 0) {
                badgesContainer.innerHTML = '<div class="col-span-2 text-center text-gray-500 py-8">No badges earned yet. Complete quizzes to earn badges!</div>';
            } else {
                badgesContainer.innerHTML = badges.map(badge => `
                    <div class="bg-gradient-to-br from-${badge.color}-100 to-${badge.color}-200 rounded-xl p-6 text-center">
                        <div class="text-4xl mb-2">${badge.icon}</div>
                        <div class="font-bold text-gray-800">${badge.name}</div>
                    </div>
                `).join('');
            }
            
            // Render quiz history
            const quizHistory = document.getElementById('quizHistory');
            const scores = currentProgress.quiz_scores || [];
            
            if (scores.length === 0) {
                quizHistory.innerHTML = '<div class="text-center text-gray-500 py-8">No quiz attempts yet. Take your first quiz to see your progress!</div>';
            } else {
                quizHistory.innerHTML = `
                    <div class="space-y-3">
                        ${scores.slice().reverse().map((score, i) => `
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                                <div>
                                    <div class="font-semibold text-gray-800">Attempt ${scores.length - i}</div>
                                    <div class="text-sm text-gray-600">${new Date(score.date).toLocaleDateString()}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold ${score.percentage >= 80 ? 'text-green-600' : score.percentage >= 60 ? 'text-yellow-600' : 'text-red-600'}">
                                        ${Math.round(score.percentage)}%
                                    </div>
                                    <div class="text-sm text-gray-600">${score.score}/${score.total} correct</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        // Show XP Animation
        function showXPAnimation(xp) {
            const animation = document.createElement('div');
            animation.className = 'fixed top-20 right-8 bg-purple-600 text-white px-6 py-3 rounded-full font-bold text-lg shadow-2xl z-50 fade-in';
            animation.textContent = `+${xp} XP!`;
            document.body.appendChild(animation);
            
            setTimeout(() => {
                animation.remove();
            }, 2000);
        }

        // Create Confetti Effect
        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            const colors = ['#FFD700', '#FFA500', '#FF69B4', '#87CEEB', '#98FB98'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti fixed text-2xl';
                    confetti.textContent = ['üéâ', '‚≠ê', '‚ú®', 'üèÜ', 'üéä'][Math.floor(Math.random() * 5)];
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-50px';
                    confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                    container.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 100);
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>    </div>
                
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2 bg-purple-100 px-3 py-1 rounded-full">
                        <span class="text-xl">‚≠ê</span>
                        <span class="font-bold text-purple-700"><span id="xpCount">0</span> XP</span>
                    </div>
                    <div class="flex items-center gap-2 bg-blue-100 px-3 py-1 rounded-full">
                        <span class="text-xl">üéØ</span>
                        <span class="font-bold text-blue-700">Level <span id="levelCount">1</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Navigation Tabs -->
        <div class="bg-white rounded-2xl shadow-xl p-2 mb-8 flex gap-2">
            <button onclick="showSection('lessons')" id="tab-lessons" class="flex-1 py-3 px-6 rounded-xl font-semibold transition-all hover-scale bg-gradient-to-r from-blue-500 to-purple-500 text-white">
                üìö Lessons
            </button>
            <button onclick="showSection('quiz')" id="tab-quiz" class="flex-1 py-3 px-6 rounded-xl font-semibold transition-all hover-scale bg-gray-100 text-gray-700 hover:bg-gray-200">
                üéØ Quiz
            </button>
            <button onclick="showSection('checklist')" id="tab-checklist" class="flex-1 py-3 px-6 rounded-xl font-semibold transition-all hover-scale bg-gray-100 text-gray-700 hover:bg-gray-200">
                ‚úÖ Checklist
            </button>
            <button onclick="showSection('progress')" id="tab-progress" class="flex-1 py-3 px-6 rounded-xl font-semibold transition-all hover-scale bg-gray-100 text-gray-700 hover:bg-gray-200">
                üìä Progress
            </button>
        </div>

        <!-- Lessons Section -->
        <div id="section-lessons" class="space-y-6">
            <div class="text-center mb-8 slide-in">
                <h1 class="text-4xl font-bold gradient-text mb-2">Master HIPAA Compliance</h1>
                <p class="text-gray-600 text-lg">Interactive lessons designed for pharmacy professionals</p>
            </div>
            
            <div id="lessonsContainer" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <!-- Quiz Section -->
        <div id="section-quiz" class="hidden">
            <div id="quizStart" class="max-w-2xl mx-auto">
                <div class="bg-white rounded-3xl shadow-2xl p-12 text-center fade-in">
                    <div class="text-6xl mb-6 float">üéØ</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Ready to Test Your Knowledge?</h2>
                    <p class="text-gray-600 mb-8">Complete 5 real-world HIPAA scenarios and earn XP!</p>
                    <button onclick="startQuiz()" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 px-12 rounded-2xl hover:shadow-xl transition-all hover-scale text-lg">
                        Start Quiz ‚Üí
                    </button>
                </div>
            </div>
            
            <div id="quizQuestions" class="hidden max-w-4xl mx-auto"></div>
            <div id="quizResults" class="hidden max-w-3xl mx-auto"></div>
        </div>

        <!-- Checklist Section -->
        <div id="section-checklist" class="hidden">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-3xl shadow-2xl p-8 fade-in">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">HIPAA Compliance Checklist</h2>
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-semibold text-gray-600">Overall Compliance</span>
                            <span class="text-sm font-semibold text-blue-600"><span id="checklistPercentage">0</span>%</span>
                        </div>
                        <div class="h-4 bg-gray-200 rounded-full overflow-hidden">
                            <div id="checklistProgress" class="h-full bg-gradient-to-r from-green-400 to-green-600 transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div id="checklistContainer" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div id="section-progress" class="hidden">
            <div class="max-w-5xl mx-auto grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-3xl shadow-2xl p-8 fade-in">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">Your Statistics</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-purple-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Total XP Earned</span>
                            <span class="text-2xl font-bold text-purple-600" id="totalXP">0</span>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-blue-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Current Level</span>
                            <span class="text-2xl font-bold text-blue-600" id="currentLevel">1</span>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-orange-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Learning Streak</span>
                            <span class="text-2xl font-bold text-orange-600"><span id="currentStreak">0</span> days</span>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-green-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Lessons Completed</span>
                            <span class="text-2xl font-bold text-green-600" id="lessonsCompleted">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-3xl shadow-2xl p-8 fade-in">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">Badges Earned</h3>
                    <div id="badgesContainer" class="grid grid-cols-2 gap-4"></div>
                </div>
                
                <div class="md:col-span-2 bg-white rounded-3xl shadow-2xl p-8 fade-in">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">Quiz History</h3>
                    <div id="quizHistory"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State Management
        let currentProgress = {};
        let currentQuizQuestion = 0;
        let quizAnswers = [];
        let lessons = {};
        let quizQuestions = [];
        let checklistItems = [];

        // Initialize App
        async function initApp() {
            await loadProgress();
            await loadLessons();
            await loadQuizQuestions();
            await loadChecklist();
            renderLessons();
            updateStats();
        }

        // API Calls
        async function loadProgress() {
            const response = await fetch('/api/progress');
            currentProgress = await response.json();
        }

        async function loadLessons() {
            const response = await fetch('/api/lessons');
            lessons = await response.json();
        }

        async function loadQuizQuestions() {
            const response = await fetch('/api/quiz');
            quizQuestions = await response.json();
        }

        async function loadChecklist() {
            const response = await fetch('/api/checklist');
            checklistItems = await response.json();
        }

        // Update Stats Bar
        function updateStats() {
            document.getElementById('xpCount').textContent = currentProgress.xp || 0;
            document.getElementById('levelCount').textContent = currentProgress.level || 1;
            document.getElementById('streakCount').textContent = currentProgress.streak || 0;
        }

        // Section Navigation
        function showSection(section) {
            ['lessons', 'quiz', 'checklist', 'progress'].forEach(s => {
                document.getElementById(`section-${s}`).classList.add('hidden');
                document.getElementById(`tab-${s}`).className = 'flex-1 py-3 px-6 rounded-xl font-semibold transition-all hover-scale bg-gray-100 text-gray-700 hover:bg-gray-200';
            });
            
            document.getElementById(`section-${section}`).classList.remove('hidden');
            document.getElementById(`tab-${section}`).className = 'flex-1 py-3 px-6 rounded-xl font-semibold transition-all hover-scale bg-gradient-to-r from-blue-500 to-purple-500 text-white';
            
            if (section === 'checklist') renderChecklist();
            if (section === 'progress') renderProgress();
        }

        // Render Lessons
        function renderLessons() {
            const container = document.getElementById('lessonsContainer');
            container.innerHTML = '';
            
            Object.entries(lessons).forEach(([name, data]) => {
                const isCompleted = currentProgress.lessons_completed?.includes(name);
                
                container.innerHTML += `
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover-scale transition-all cursor-pointer border-2 ${isCompleted ? 'border-green-400' : 'border-transparent'}">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-4xl">${data.icon}</div>
                            ${isCompleted ? '<div class="text-2xl">‚úÖ</div>' : ''}
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${name}</h3>
                        <p class="text-gray-600 mb-4">${data.content}</p>
                        <div class="space-y-2 mb-4">
                            ${data.key_points.map(point => `<div class="flex items-start gap-2 text-sm text-gray-700"><span>‚Ä¢</span><span>${point}</span></div>`).join('')}
                        </div>
                        <button onclick="completeLesson('${name}')" class="w-full py-2 px-4 ${isCompleted ? 'bg-green-100 text-green-700' : 'bg-gradient-to-r from-blue-500 to-purple-500 text-white'} rounded-xl font-semibold transition-all hover:shadow-lg">
                            ${isCompleted ? 'Completed +15 XP' : 'Mark Complete +15 XP'}
                        </button>
                    </div>
                `;
            });
        }

        // Complete Lesson
        async function completeLesson(lessonName) {
            const response = await fetch('/api/complete-lesson', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ lesson_name: lessonName })
            });
            
            const result = await response.json();
            if (result.success) {
                await loadProgress();
                updateStats();
                renderLessons();
                showXPAnimation(result.xp_earned);
            }
        }

        // Start Quiz
        function startQuiz() {
            document.getElementById('quizStart').classList.add('hidden');
            document.getElementById('quizQuestions').classList.remove('hidden');
            currentQuizQuestion = 0;
            quizAnswers = [];
            renderQuizQuestion();
        }

        // Render Quiz Question
        function renderQuizQuestion() {
            const question = quizQuestions[currentQuizQuestion];
            const progress = ((currentQuizQuestion + 1) / quizQuestions.length) * 100;
            
            document.getElementById('quizQuestions').innerHTML = `
                <div class="fade-in">
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-semibold text-gray-600">Question ${currentQuizQuestion + 1} of ${quizQuestions.length}</span>
                            <span class="text-sm font-semibold text-blue-600">${Math.round(progress)}% Complete</span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-3xl shadow-2xl p-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">${question.question}</h3>
                        <div class="space-y-3">
                            ${question.options.map((option, index) => `
                                <button onclick="answerQuestion(${index})" class="w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all font-medium text-gray-700 hover-scale">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>
